{
    "contents" : "rm(list = ls())\n\n\nload('C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/allpostfans.RData')\nload('C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/cc.RData')\nload('C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/n.RData')\n\na=allpostfans\n\nY = model.matrix(~as.factor(cc)-1)\nyy = solve(t(Y)%*%Y)\nhc=Y%*%yy%*%t(Y)\nI=diag(1,length(cc))\n\nnc = ncol(a)\ncs = colSums(a)\ntau = cs/nc\nDcol = Diagonal(n = nc, x = 1/(cs + tau))\n\nLb=Dcol%*%(I-hc)\n#L1=a[1:50000,]%*%Lb\n#L2=a[50001:92226,]%*%Lb\n\n#save(L1,L2, file = \"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/svddelL1L2.RData\")\n\nL=rbind_spmatrix(L1,L2)\n\ndim(L)\n#save(L, file = \"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/svddelL.RData\")\n\n#library(irlba)\n#sdelete = irlba(L, nu = 20, nv = 20)\n\n#save(sdelete, file = \"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/svddeletestructure.RData\")\n\nload('C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/allpostfans.RData')\nload('C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/cc.RData')\nload('C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/n.RData')\nload('C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/cc.RData')\nload(\"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/svddeletestructure.RData\")\nload(\"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/postdates.RData\")\n\n#sdelete\n\nncluster=5;ndate=length(unidate);npost=length(allpostfans[1,])\n\npar(mfrow=c(1,1))\nplot(sdelete$d,ylab=\"singular values\",main=\"svd after deleting cadidate structure\")\nv = sdelete$v[,1:ncluster]\nv = t(apply(v,1,function(x) return(x/sqrt(sum(x^2)))))\n\nsvbd = sv_bydate(v, mdates, cc, npost, ncluster)\nvd = svbd$vd; vdl = svbd$vdl; dfvdl = svbd$dfvdl; daten = svbd$daten\n\npar(mfrow = c(3,1), mar = rep(1,4))\npar(xpd=TRUE)\ni=1; plot(vd[,i], ylab = \"\", xlab=\"\", col = cc)\nlegend(3100,0.5,c(\"lepen\",\"joly\",\"bayrou\",\"hollande\",\n                    \"melenchon\",\"dupont\",\"sarkozy\",\"poutou\"),\n       col=1:8,pch=rep(16,8))\nfor(i in 2:3) plot(vd[,i], ylab = \"\", xlab=\"\", col = cc)\nfor(i in 4:5) plot(vd[,i], ylab = \"\", xlab=\"\", col = cc)\n\npar(mfrow = c(3,1), mar = rep(1,4))\ni=1; plot(vdl[,i], ylab = \"\", xlab=\"\", col = dfvdl[,7])\nlegend(3100,0.5,c(\"lepen\",\"joly\",\"bayrou\",\"hollande\",\n                  \"melenchon\",\"dupont\",\"sarkozy\",\"poutou\"),\n       col=1:8,pch=rep(16,8))\nfor(i in 2:3) plot(vdl[,i], ylab = \"\", xlab=\"\", col = dfvdl[,7])\nfor(i in 4:5) plot(vdl[,i], ylab = \"\", xlab=\"\", col = dfvdl[,7])\npar(xpd=FALSE)\ni=5;plot(vdl[,i], ylab = \"\", xlab=\"\", col = dfvdl[,7])\nlegend(\"right\",   c(\"lepen\",\"joly\",\"bayrou\",\"hollande\",\n                  \"melenchon\",\"dupont\",\"sarkozy\",\"poutou\"),\n       col=1:8,pch=rep(16,8))\nfor(d in 1:102) abline(v=daten[d],col=\"grey\")\nabline(v=daten[55]);abline(v=daten[87]);abline(v=daten[101]);\n########################################################\n\n\n#km5 = kmeans(v, centers = 5, nstart = 1000)\n#save(km5, file = \"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/delstrkm5.RData\")\n\nload(\"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/delstrkm5.RData\")\n\nkmcluster=km5$cluster\n\nvv=solve(t(v)%*%v)\nHv=v%*%vv%*%t(v)\nHii=diag(Hv)\nHiio=sort(Hii,decreasing=TRUE)\nHsort=match(Hii,Hiio)\n\nals=rep(0,ncluster)\nfor (i in 1:ncluster)\n{\n  ci=which(kmcluster==i)\n  als[i]=mean(Hii[ci])\n}\n\nalso=sort(als,decreasing=TRUE)\nalsort=match(als,also)\n\nclusort=rep(0,npost);clusn=rep(0,ncluster);postoc=rep(0,npost)\nfor (i in 1:ncluster)\n{\n  ci=which(kmcluster==i)\n  clusort[ci]=rep(alsort[i],length(ci))\n  \n  clusn[i]=length(which(clusort==i))\n  \n  #post order within each cluster\n  pi=Hii[ci]\n  pio=sort(pi,decreasing=TRUE)\n  postoc[ci]=match(pi,pio)\n}\n\norder=1:5\ndel_clus=data.frame(order,clusn,also)\ncolnames(del_clus)=c(\"order\",\"#posts\", \"average_leverage\")\n\ndel_posts=data.frame(clusort,Hsort,postoc)\ncolnames(del_posts)=c(\"cluster order\",\"post order\",\"post within cluster order\")\n\nsave(del_posts, file = \"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/delposts.RData\")\nsave(del_clus, file = \"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/del_clus.RData\")\nsave(alsort, file = \"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/delclusalsort.RData\")\n\n\n\n\n########################################################\nid=1:npost\ndf=data.frame(kmcluster,cc,id)\ndfo=df[order(df$kmcluster),]\nndfo=rep(0,5)\nfor (i in 1:5){ndfo[i]=sum(kmcluster==i)}\nnmatr=matrix(0,ncol=8,nrow=5)\nfor (i in 1:5)\n{\n  for (j in 1:8)\n  {\n    nmatr[i,j]=sum(df$kmcluster==i & df$cc==j)\n  }\n}\n#posts in clusters\nrn=c(\"poclus1\",\"poclus2\",\"poclus3\",\"poclus4\",\n     \"poclus5\")\ncn=c(\"Lepen\", \"Joly\", \"Bayrou\", \"Hollande\", \"Melenchon\", \"Dupont\", \"Sarkozy\", \"Poutou\")\nrownames(nmatr)=rn\ncolnames(nmatr)=cn\n\nnmatr[alsort,]\nrowSums(nmatr)\ncolSums(nmatr)\npar(mfrow=c(1,1))\nballoonPlot(nmatr[alsort,],TRUE, FALSE, \"number of posts\", cn, rn, 4,1)\n\nkmucluster=km5u$cluster\nfanid=1:92226\ndfu=data.frame(kmucluster,fanid)\ndfuo=dfu[order(dfu$kmucluster),]\nfpmatr=matrix(0,ncol=5,nrow=5)\nfor (s in 1:5)\n{\n  for (t in 1:5)\n  {\n    pid=dfo[dfo$kmcluster==s,3]\n    fid=dfuo[dfuo$kmucluster==t,2]\n    fpmatr[s,t]=sum(allpostfans[fid,pid])\n  }\n}\n#comments of fan group s in post group t\n\nfpmatr\n#########################################################################\n\npar(mfrow = c(1,1))\nlibrary(fpc)\nplotcluster(v, km5$cluster)\n\n\n#choose km5\n\nload(\"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/delstrkm5.RData\")\nload(\"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/delclusalsort.RData\")\n\nnclus=5;ncan=8\nns=rep(0,8); for (i in 1:8) {ns[i]=sum(n[1:i])}\nns0=c(0,ns)\nbp=matrix(0,nrow=nclus,ncol=ncan)\n# j candidate, i clusters\nfor(j in 1:ncan)\n{for (i in 1:nclus)\n{bp[i,j]=sum(km5$cluster[(ns0[j]+1):ns0[j+1]]==i)}\n}\nrownames(bp)=c(\"cluster1\",\"cluster2\",\"cluster3\",\"cluster4\",\"cluster5\")\ncolnames(bp)=c(\"lepen\",\"joly\",\"bayrou\",\"hollande\",\n               \"melenchon\",\"dupont\",\"sarkozy\",\"poutou\")\npar(mfrow=c(1,1))\nballoonPlot(bp[alsort,],TRUE,FALSE,\"\",)\nbp\n####################################################################\n\n\n\nnkm=4\nkm4_poid=NULL;\nfor (i in 1:nkm) {km4_poid=c(km4_poid,which(km4$cluster==i))}\n\nncc=rep(0,8)\nfor(i in 1:8) {ncc[i]=sum(n[1:i])}\nncc=c(0,ncc)\npcc=rep(0,length(km4_poid))\nfor(i in 1:length(km4_poid))\n{\n  for(j in 1:8)\n  {\n    if(ncc[j]<km4_poid[i] && km4_poid[i]<ncc[j+1]+1)\n    {pcc[i]=j}\n  }\n}\npar(mfrow=c(1,1))\nplot(km4_poid,col=pcc)\n\n\n#####################################################################\n\n\n\ndim(allpostfans)\nnr=nrow(allpostfans)\npoef=rep(0,nr)\ndgef=rep(0,nr)\nfor(i in 1:nr)\n{poef[i]=sum(allpostfans[i,]>0)\n dgef[i]=sum(allpostfans[i,])}\n#hist(poef,breaks=nr)\n#hist(dgef,breaks=nr)\nsummary(poef)\nsummary(dgef)\n\nnkm=3\n\nload(\"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/n.RData\")\n\nkm3_po=rep(0,nkm)\nkm3_fa=rep(0,nkm)\nkm3_dg=rep(0,nkm)\nkm3_faid=NULL\nfor(j in 1:nkm)\n{\n  km3_po[j]=sum(km3$cluster==j)\n  km3_dg[j]=sum(allpostfans[,km3$cluster==j])\n}\n\nfor(j in 1:nkm)\n{\n  for(i in 1:nr)\n  {if(sum(allpostfans[i,km3$cluster==j])>0) \n  {km3_fa[j]=km3_fa[j]+1\n   km3_faid=c(km3_faid,i)}\n  }\n}\n#plot(km3_po)\n#plot(km3_dg)\n#plot(km3_fa)\nkm3_po\nkm3_dg\nkm3_fa\n\npar(mfrow=c(1,1))\nplot(km3_faid)\n\nkm3_poef=matrix(0,nrow=nr,ncol=nkm)\nkm3_dgef=matrix(0,nrow=nr,ncol=nkm)\n\nfor(i in 1:nr)\n{\n  for(j in 1:nkm)\n  {if(sum(allpostfans[i,km3$cluster==j])>0)\n  {km3_poef[i,j]=km3_poef[i,j]+sum(allpostfans[i,km3$cluster==j]>0)\n   km3_dgef[i,j]=km3_dgef[i,j]+sum(allpostfans[i,km3$cluster==j])\n  }\n  }\n}\n\n#par(mfrow=c(nkm,2))\n#for(j in 1:nkm)\n#{hist(km3_poef[km3_poef[,j]>0,j],breaks=nr)\n# hist(km3_dgef[km3_dgef[,j]>0,j],breaks=nr)\n#}\n\nsummary(km3_poef[km3_poef[,1]>0,1])\nsummary(km3_poef[km3_poef[,2]>0,2])\nsummary(km3_poef[km3_poef[,3]>0,3])\nsummary(km3_dgef[km3_dgef[,1]>0,1])\nsummary(km3_dgef[km3_dgef[,2]>0,2])\nsummary(km3_dgef[km3_dgef[,3]>0,3])\n\n#for(j in 1:nkm)\n#{hist(km3_dgef[km3_dgef[,j]>15,j],breaks=nr)\n#}\n\n#for (j in 1:nkm)\n#{plot(km3_poef[km3_poef[,j]>0,j])\n# plot(km3_dgef[km3_dgef[,j]>0,j])}\n\n#save(poef, file = \"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/delstrpoef.RData\")\n#save(dgef, file = \"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/delstrdgef.RData\")\n#save(km3_poef, file = \"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/delstrkm3poef.RData\")\n#save(km3_dgef, file = \"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/delstrkm3dgef.RData\")\n#save(km3_po, file = \"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/delstrkm3po.RData\")\n#save(km3_fa, file = \"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/delstrkm3fa.RData\")\n#save(km3_dg, file = \"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/delstrkm3dg.RData\")\n#save(km3_faid, file = \"C:/Users/Administrator/Dropbox/my project/frenchFacebook/data/delstrkm3faid.RData\")\n\n",
    "created" : 1430667507395.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4073069142",
    "id" : "4AF1875E",
    "lastKnownWriteTime" : 1430673871,
    "path" : "C:/Users/Administrator/Dropbox/my project/frenchFacebook/code/deletestructures.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}